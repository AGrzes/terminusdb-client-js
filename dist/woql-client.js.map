{"version":3,"sources":["../lib/connectionCapabilities.js","../lib/connectionConfig.js","../lib/const.js","../lib/dispatchRequest.js","../lib/errorMessage.js","../lib/terminusIDParser.js","../lib/utils.js","../lib/woqlClient.js"],"names":[],"mappings":"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","file":"woql-client.js","sourcesContent":["const UTILS = require('./utils');\nconst CONST = require('./const');\nconst ErrorMessage = require('./errorMessage');\n/*\n * Creates an entry in the connection registry for the server\n * and all the databases that the client has access to\n * maps the input authorties to a per-db array for internal storage and easy\n * access control checks\n * {doc:dbid => {terminus:authority =>\n * [terminus:woql_select, terminus:create_document, auth3, ...]}}\n *\n */\n\nfunction ConnectionCapabilities(connectionConfig, key) {\n\tthis.connection = {};\n\tthis.connectionConfig = connectionConfig;\n\tif (this.connectionConfig.server && key) {\n\t\tthis.setClientKey(this.connectionConfig.server, key);\n\t}\n}\n\n\n/*\n * Utility functions for changing the state of connections with Terminus servers\n */\nConnectionCapabilities.prototype.setClientKey = function (curl, key) {\n\tif (typeof this.connection[curl] === 'undefined') {\n\t\tthis.connection[curl] = {};\n\t}\n\tkey = key.trim();\n\tif (key) {\n\t\tthis.connection[curl].key = key;\n\t}\n};\n\n\n/**\n * @params {string} curl a valid terminusDB server URL\n * @params {object} capabilities it is the connect call response\n */\nConnectionCapabilities.prototype.addConnection = function (curl, capabilities) {\n\tif (typeof this.connection[curl] === 'undefined') {\n\t\tthis.connection[curl] = {};\n\t}\n\tconst capabilitiesKeys = capabilities ? Object.keys(capabilities) : [];\n\n\tfor (const pred of capabilitiesKeys) {\n\t    if (pred === 'terminus:authority' && capabilities[pred]) {\n\t      const auths = Array.isArray(capabilities[pred]) === true\n\t        ? capabilities[pred]\n\t        : [capabilities[pred]];\n\n\t      for (let i = 0; i < auths.length; i += 1) {\n\t        let scope = auths[i]['terminus:authority_scope'];\n\t        const actions = auths[i]['terminus:action'];\n\n\t        if (Array.isArray(scope) === false) scope = [scope];\n\t        const actionsArr = UTILS.authorityActionsToArr(actions);\n\n\t        for (let j = 0; j < scope.length; j += 1) {\n\t          const nrec = scope[j];\n\t          if (typeof this.connection[curl][nrec['@id']] === 'undefined') {\n\t            this.connection[curl][nrec['@id']] = nrec;\n\t          }\n\t          this.connection[curl][nrec['@id']]['terminus:authority'] = actionsArr;\n\t        }\n\t      }\n\t    } else {\n\t      this.connection[curl][pred] = capabilities[pred];\n\t    }\n\t}\n};\n\nConnectionCapabilities.prototype.serverConnected = function () {\n\treturn typeof this.connection[this.connectionConfig.server] !== 'undefined';\n};\n\nConnectionCapabilities.prototype.capabilitiesPermit = function (action, dbid, server) {\n\tif (!this.connectionConfig.connectionMode()\n         || this.connectionConfig.client_checks_capabilities !== true\n         || action === CONST.CONNECT) { return true; }\n\n\tserver = server || this.connectionConfig.server;\n\tdbid = dbid || this.connectionConfig.dbid;\n\n\tlet rec;\n\n\tif (action === CONST.CREATE_DATABASE) {\n\t\trec = this.getServerRecord(server);\n\t} else {\n\t\trec = this.getDBRecord(dbid);\n\t}\n\tif (rec) {\n\t\tconst auths = rec['terminus:authority'];\n\t\t// console.log('auths',auths);\n\t\tif (auths && auths.indexOf(`terminus:${action}`) !== -1) return true;\n\t} else {\n\t\tconsole.error('problem with ', action, server, dbid);\n\t}\n\tthis.error = ErrorMessage.accessDenied(action, dbid, server);\n\treturn false;\n};\n\nConnectionCapabilities.prototype.getServerRecord = function (srvr) {\n\tconst url = (srvr || this.connectionConfig.server);\n\tconst connectionObj = this.connection[url] || {};\n\n\tfor (const oid of Object.keys(connectionObj)) {\n\t\tif (this.connection[url][oid]['@type'] === 'terminus:Server') {\n\t\t\treturn this.connection[url][oid];\n\t\t}\n\t}\n\treturn false;\n};\n\nConnectionCapabilities.prototype.getDBRecord = function (dbid, srvr) {\n\tconst url = (srvr || this.connectionConfig.server);\n\tdbid = (dbid || this.connectionConfig.dbid);\n\tif (typeof this.connection[url] !== 'object') {\n\t\treturn false;\n\t}\n\tif (typeof this.connection[url][dbid] !== 'undefined') { return this.connection[url][dbid]; }\n\n\tdbid = this.dbCapabilityID(dbid);\n\n\tif (typeof this.connection[url][dbid] !== 'undefined') { return this.connection[url][dbid]; }\n\n\treturn undefined;\n};\n\nConnectionCapabilities.prototype.getServerDBRecords = function (srvr) {\n\tconst url = (srvr || this.connectionConfig.server);\n\tconst dbrecs = {};\n\tconst connectionObj = this.connection[url] || {};\n\n\tfor (const oid of Object.keys(connectionObj)) {\n\t\tif (this.connection[url][oid]['@type'] === 'terminus:Database') {\n\t\t\tdbrecs[oid] = this.connection[url][oid];\n\t\t}\n\t}\n\treturn dbrecs;\n};\n\n/*\n * removes a database record from the connection registry (after deletion, for example)\n */\nConnectionCapabilities.prototype.removeDB = function (dbid, srvr) {\n\tif (dbid && this.connectionConfig.dbid && this.connectionConfig.dbid === dbid) {\n\t\tthis.connectionConfig.dbid = false;\n\t}\n\tdbid = dbid || this.connectionConfig.dbid;\n\tconst url = srvr || this.connectionConfig.server;\n\tdbid = this.dbCapabilityID(dbid);\n\tdelete this.connection[url][dbid];\n};\n\n\nConnectionCapabilities.prototype.dbCapabilityID = function (dbid) {\n\treturn `doc:${dbid}`;\n};\n\nConnectionCapabilities.prototype.getDBRecord = function (dbid, srvr) {\n\tconst url = srvr || this.connectionConfig.server;\n\tdbid = dbid || this.connectionConfig.dbid;\n\tif (typeof this.connection[url] !== 'object') {\n\t\treturn false;\n\t}\n\tif (typeof this.connection[url][dbid] !== 'undefined') { return this.connection[url][dbid]; }\n\n\tdbid = this.dbCapabilityID(dbid);\n\n\tif (typeof this.connection[url][dbid] !== 'undefined') { return this.connection[url][dbid]; }\n\n\treturn undefined;\n};\n\nmodule.exports = ConnectionCapabilities;\n","\nconst TerminusIDParser = require('./terminusIDParser');\n\nfunction ConnectionConfig(params) {\n\tconst newParams = params || {};\n\tthis.server = newParams.server || false;\n\tthis.dbid = newParams.db || false;\n\tthis.docid = newParams.document || false;\n\n\t/*\n  * client configuration options - connected_mode = connected\n  * tells the client to first connect to the server before invoking other services\n  */\n\n\tthis.connected_mode = newParams.connected_mode || 'connected';\n\t// include a terminus:user_key API key in the calls\n\tthis.include_key = newParams.include_key || true;\n\t// client side checking of access control (in addition to server-side access control)\n\tthis.client_checks_capabilities = newParams.client_checks_capabilities || true;\n}\n\nConnectionConfig.prototype.serverURL = function () {\n\treturn this.server;\n};\n\n\nConnectionConfig.prototype.connectionMode = function () {\n\treturn this.connected_mode === 'connected';\n};\n\nConnectionConfig.prototype.includeKey = function () {\n\treturn this.include_key === true;\n};\n\nConnectionConfig.prototype.schemaURL = function () {\n\treturn `${this.dbURL()}/schema`;\n};\nConnectionConfig.prototype.queryURL = function () {\n\treturn `${this.dbURL()}/woql`;\n};\nConnectionConfig.prototype.frameURL = function () {\n\treturn `${this.dbURL()}/frame`;\n};\nConnectionConfig.prototype.docURL = function () {\n\treturn `${this.dbURL()}/document/${this.docid ? this.docid : ''}`;\n};\n\nConnectionConfig.prototype.dbURL = function (call) {\n\t// url swizzling to talk to platform using server/dbid/platform/ pattern..\n\tif (this.platformEndpoint() && (!call || call !== 'create')) {\n\t\treturn (\n\t\t\t`${this.server.substring(0, this.server.lastIndexOf('/platform/'))\n\t\t\t}/${\n\t\t\t\tthis.dbid\n\t\t\t}/platform`\n\t\t);\n\t} if (this.platformEndpoint() && call === 'platform') {\n\t\treturn (\n\t\t\t`${this.server.substring(0, this.server.lastIndexOf('/platform/'))\n\t\t\t}/${\n\t\t\t\tthis.dbid}`\n\t\t);\n\t}\n\treturn this.server + this.dbid;\n};\n\nConnectionConfig.prototype.platformEndpoint = function () {\n\tif (this.server.lastIndexOf('/platform/') === this.server.length - 10) {\n\t\treturn true;\n\t}\n\treturn false;\n};\n\n/**\n * Utility functions for setting and parsing urls and determining\n * the current server, database and document\n */\nConnectionConfig.prototype.setServer = function (inputStr, context) {\n\tconst parser = new TerminusIDParser(inputStr, context);\n\tif (parser.parseServerURL()) {\n\t\tthis.server = parser.server();\n\t\treturn true;\n\t}\n\treturn false;\n};\n\nConnectionConfig.prototype.setDB = function (inputStr, context) {\n\tconst parser = new TerminusIDParser(inputStr, context);\n\tif (parser.parseDBID()) {\n\t\tif (parser.server()) this.server = parser.server();\n\t\tthis.dbid = parser.dbid();\n\t\treturn true;\n\t}\n\treturn false;\n};\n\nConnectionConfig.prototype.setSchemaURL = function (inputStr, context) {\n\tconst parser = new TerminusIDParser(inputStr, context);\n\tif (parser.parseSchemaURL()) {\n\t\tif (parser.server()) this.server = parser.server();\n\t\tthis.dbid = parser.dbid();\n\t\tthis.docid = false;\n\t\treturn true;\n\t}\n\treturn false;\n};\n\nConnectionConfig.prototype.setDocument = function (inputStr, context) {\n\tconst parser = new TerminusIDParser(inputStr, context);\n\tif (parser.parseDocumentURL()) {\n\t\tif (parser.server()) this.server = parser.server();\n\t\tif (parser.dbid()) this.dbid = parser.dbid();\n\t\tif (parser.docid()) this.docid = parser.docid();\n\t\treturn true;\n\t}\n\treturn false;\n};\n\nConnectionConfig.prototype.setQueryURL = function (inputStr, context) {\n\tconst parser = new TerminusIDParser(inputStr, context);\n\tif (parser.parseQueryURL()) {\n\t\tif (parser.server()) this.server = parser.server();\n\t\tthis.dbid = parser.dbid();\n\t\tthis.docid = false;\n\t\treturn true;\n\t}\n\treturn false;\n};\n\nConnectionConfig.prototype.setClassFrameURL = function (inputStr, context) {\n\tconst parser = new TerminusIDParser(inputStr, context);\n\tif (parser.parseClassFrameURL()) {\n\t\tif (parser.server()) this.server = parser.server();\n\t\tthis.dbid = parser.dbid();\n\t\tthis.docid = false;\n\t\treturn true;\n\t}\n\treturn false;\n};\n\nmodule.exports = ConnectionConfig;\n","\nmodule.exports = Object.freeze({\n\tCONNECT: 'connect',\n\tGET_SCHEMA: 'get_schema',\n\tCLASS_FRAME: 'class_frame',\n\tWOQL_SELECT: 'woql_select',\n\tGET_DOCUMENT: 'get_document',\n\tDELETE_DATABASE: 'delete_database',\n\tDELETE_DOCUMENT: 'delete_document',\n\tCREATE_DATABASE: 'create_database',\n\tWOQL_UPDATE: 'woql_update',\n});\n\n/*\n{\"extends\": \"strongloop\",\n  \"env\": {\n\t\t\"browser\": true,\n\t\t\"node\": true,\n\t\t\"es6\": true\n  },\n  \"rules\":{\"max-len\": [\"error\", { \"code\": 100 }]},\n \"parserOptions\": { \"ecmaVersion\": 6 }}\n*/\n","\nconst axios = require('axios');\nconst CONST = require('./const.js');\nconst ErrorMessage = require('./errorMessage');\n\nfunction getOptionsByAction(options, action, payload) {\n\tlet method = 'get';\n\tconsole.log('ACTIONACTION', action);\n\tswitch (action) {\n\tcase CONST.CONNECT:\n\tcase CONST.GET_SCHEMA:\n\tcase CONST.CLASS_FRAME:\n\tcase CONST.WOQL_SELECT:\n\tcase CONST.GET_DOCUMENT:\n\t\tif (payload)options.params = payload;\n\t\tbreak;\n\tcase CONST.DELETE_DATABASE:\n\tcase CONST.DELETE_DOCUMENT:\n\t\tmethod = 'delete';\n\t\tbreak;\n\tcase CONST.CREATE_DATABASE:\n\tcase CONST.UPDATE_SCHEMA:\n\tcase CONST.CREATE_DOCUMENT:\n\tcase CONST.UPDATE_DOCUMENT:\n\tcase CONST.WOQL_UPDATE:\n\t\tmethod = 'post';\n\t\toptions.headers = { 'Content-Type': 'application/json' };\n\t\toptions.data = JSON.stringify(payload);\n\t\tbreak;\n\tdefault:\n\t\treturn 'get';\n\t}\n\treturn method;\n}\n\nfunction DispatchRequest(url, action, payload) {\n\t// /axios[method](url, data, config)\n\tconst options = {\n\t\tmode: 'cors', // no-cors, cors, *same-origin\n\t\tredirect: 'follow', // manual, *follow, error\n\t\treferrer: 'client',\n\t\t// url:url,\n\t\t// no-referrer, *client\n\t};\n\tconst method = getOptionsByAction(options, action, payload) || 'get';\n\n\t/* if (this.connectionConfig.platformEndpoint()) {\n\t\toptions.credentials = 'include'; // include, *same-origin, omit\n\t} */\n\n\treturn axios[method](url, options)\n\t\t.then(response => response.data)\n\t\t.catch((err) => {\n\t\t\tconsole.log(err);\n\t\t\tPromise.reject(\n\t\t\t\tnew Error(ErrorMessage.getAPIErrorMessage(url, options))\n\t\t\t);\n\t\t});\n}\n\nmodule.exports = DispatchRequest;\n","\n\nfunction getErrorAsMessage(url, api, err) {\n\tlet str = `Code: ${err.status}`;\n\tif (err.body) str += `, Message: ${err.body}`;\n\tif (err.action) str += `, Action: ${err.action}`;\n\tif (err.type) str += `, Type: ${err.type}`;\n\tif (url) str += `, url: ${url}`;\n\tif (api && api.method) str += `, method: ${api.method}`;\n\treturn str;\n}\n\nfunction accessDenied(action, db, server) {\n\tconst err = {};\n\terr.status = 403;\n\terr.url = (server || '') + (db || '');\n\terr.type = 'client';\n\terr.action = action;\n\terr.body = `${err.action} not permitted for ${err.url}`;\n\treturn err;\n}\n\nfunction getAPIErrorMessage(url, api, err) {\n\treturn `API Error ${getErrorAsMessage(url, api, err)}`;\n}\n\nfunction getAccessDeniedMessage(url, api, err) {\n\treturn `Access Denied ${getErrorAsMessage(url, api, err)}`;\n}\n\nfunction getInvalidURIMessage(url, call) {\n\tconst str = `Invalid argument to\n            ${call}. \n            ${url}\n            is not a valid Terminus DB API endpoint`;\n\treturn str;\n}\n\n/**\n * Utility functions for generating and retrieving error messages\n * and storing error state\n */\n\nfunction parseAPIError(response) {\n\tconst err = {};\n\terr.status = response.status;\n\terr.type = response.type;\n\tif (response.data && typeof response.data === 'object') {\n\t\tlet msg;\n\t\ttry {\n\t\t\tmsg = response.text();\n\t\t} catch (e) {\n\t\t\ttry {\n\t\t\t\tmsg = response.json();\n\t\t\t} catch (error) {\n\t\t\t\tmsg = response.toString();\n\t\t\t}\n\t\t}\n\t\terr.body = msg;\n\t} else if (response.data) err.body = response.data;\n\terr.url = response.url;\n\terr.headers = response.headers;\n\terr.redirected = response.redirected;\n\treturn err;\n}\n\n\nmodule.exports = {\n\tgetErrorAsMessage,\n\tgetAPIErrorMessage,\n\tgetAccessDeniedMessage,\n\taccessDenied,\n\tgetInvalidURIMessage,\n\tparseAPIError\n};\n","\n/*\n * Helper class for parsing and decomposing Terminus URLs /\n * dealing with prefixed URLs\n */\nfunction TerminusIDParser(inputStr, context) {\n\tthis.contents = inputStr.trim();\n\tthis.context = context;\n\tthis.server_url = false;\n\tthis.db = false;\n\tthis.doc = false;\n}\n\nTerminusIDParser.prototype.server = function () {\n\treturn this.server_url;\n};\n\nTerminusIDParser.prototype.dbid = function () {\n\treturn this.db;\n};\n\nTerminusIDParser.prototype.docid = function () {\n\treturn this.doc;\n};\n\nTerminusIDParser.prototype.parseServerURL = function (str) {\n\tstr = str || this.contents;\n\tif (this.validURL(str)) {\n\t\tthis.server_url = str;\n\t} else if (this.context && this.validPrefixedURL(str, context)) {\n\t\tthis.server_url = this.expandPrefixed(str, context);\n\t}\n\tif (\n\t\tthis.server_url\n    && this.server_url.lastIndexOf('/') !== this.server_url.length - 1\n\t) {\n\t\tthis.server_url += '/';\n\t}\n\treturn this.server_url;\n};\n\nTerminusIDParser.prototype.parseDBID = function (str) {\n\tstr = str || this.contents;\n\tif (this.context && this.validPrefixedURL(str, context)) {\n\t\tstr = this.expandPrefixed(str, context);\n\t}\n\tif (this.validURL(str)) {\n\t\tif (str.lastIndexOf('/') === str.length - 1) str = str.substring(0, str.length - 1); // trim trailing slash\n\t\tconst surl = str.substring(0, str.lastIndexOf('/'));\n\t\tconst dbid = str.substring(str.lastIndexOf('/') + 1);\n\t\tif (this.parseServerURL(surl)) {\n\t\t\tthis.db = dbid;\n\t\t}\n\t} else if (this.validIDString(str)) {\n\t\tthis.db = str;\n\t}\n\treturn this.db;\n};\n\nTerminusIDParser.prototype.parseDocumentURL = function (str) {\n\tstr = str || this.contents;\n\tif (this.context && this.validPrefixedURL(str, context)) {\n\t\tstr = this.expandPrefixed(str, context);\n\t}\n\tif (this.validURL(str)) {\n\t\tif (str.lastIndexOf('/document/') !== -1) {\n\t\t\tthis.doc = str.substring(str.lastIndexOf('/document/') + 11);\n\t\t\tstr = str.substring(0, str.lastIndexOf('/document/'));\n\t\t}\n\t\treturn this.parseDBID(str);\n\t} if (this.validIDString(str)) {\n\t\tthis.doc = str;\n\t\treturn true;\n\t}\n\treturn false;\n};\n\nTerminusIDParser.prototype.parseSchemaURL = function (str) {\n\tstr = str || this.contents;\n\tif (this.context && this.validPrefixedURL(str, context)) {\n\t\tstr = this.expandPrefixed(str, context);\n\t}\n\tif (this.validURL(str)) {\n\t\tstr = this.stripOptionalPath(str, 'schema');\n\t}\n\treturn this.parseDBID(str);\n};\n\nTerminusIDParser.prototype.parseQueryURL = function (str) {\n\tstr = str || this.contents;\n\tif (this.context && this.validPrefixedURL(str, context)) {\n\t\tstr = this.expandPrefixed(str, context);\n\t}\n\tif (this.validURL(str)) {\n\t\tstr = this.stripOptionalPath(str, 'woql');\n\t\tstr = this.stripOptionalPath(str, 'query');\n\t}\n\treturn this.parseDBID(str);\n};\n\nTerminusIDParser.prototype.stripOptionalPath = function (str, bit) {\n\tif (str.indexOf(`/${bit}`) !== -1) str = str.substring(0, str.indexOf(`/${bit}`));\n\treturn str;\n};\n\nTerminusIDParser.prototype.parseClassFrameURL = function (str) {\n\tstr = str || this.contents;\n\tif (this.context && this.validPrefixedURL(str, context)) {\n\t\tstr = this.expandPrefixed(str, context);\n\t}\n\tif (this.validURL(str)) {\n\t\tstr = this.stripOptionalPath(str, 'schema');\n\t}\n\treturn this.parseDBID(str);\n};\n\nTerminusIDParser.prototype.validURL = function (str) {\n\tconst pattern = new RegExp(\n\t\t'^(https?:\\\\/\\\\/)?' // protocol\n    + 'localhost|((([a-z\\\\d]([a-z\\\\d-]*[a-z\\\\d])*)\\\\.)+[a-z]{2,}|' // domain name\n    + '((\\\\d{1,3}\\\\.){3}\\\\d{1,3}))' // OR ip (v4) address\n    + '(\\\\:\\\\d+)?(\\\\/[-a-z\\\\d%_.~+]*)*' // port and path\n    + '(\\\\?[;&a-z\\\\d%_.~+=-]*)?' // query string\n      + '(\\\\#[-a-z\\\\d_]*)?$',\n\t\t'i'\n\t); // fragment locator\n\treturn pattern.test(str);\n};\n\nTerminusIDParser.prototype.validPrefixedURL = function (str, context) {\n\tconst parts = str.split(':');\n\tif (parts.length !== 2) return false;\n\tif (parts[0].length < 1 || parts[1].length < 1) return false;\n\tif (context && context[parts[0]] && this.validIDString(parts[1])) return true;\n\treturn false;\n};\n\nTerminusIDParser.prototype.validIDString = function (str) {\n\tif (str.indexOf(' ') !== -1 || str.indexOf('/') !== -1) return false;\n\treturn true;\n};\n\nTerminusIDParser.prototype.expandPrefixed = function (str, context) {\n\tconst parts = str.split(':');\n\treturn context[parts[0]] + parts[1];\n};\n\nmodule.exports = TerminusIDParser;\n","\n/*\n[\n      {\"@id\":\"terminus:class_frame\", \"@type\":\"terminus:DBAction\"},\n      {\"@id\":\"terminus:create_database\", \"@type\":\"terminus:DBAction\"},\n      {\"@id\":\"terminus:create_document\", \"@type\":\"terminus:DBAction\"},\n      {\"@id\":\"terminus:delete_database\", \"@type\":\"terminus:DBAction\"},\n      {\"@id\":\"terminus:delete_document\", \"@type\":\"terminus:DBAction\"},\n      {\"@id\":\"terminus:get_document\", \"@type\":\"terminus:DBAction\"},\n      {\"@id\":\"terminus:get_schema\", \"@type\":\"terminus:DBAction\"},\n      {\"@id\":\"terminus:update_document\", \"@type\":\"terminus:DBAction\"},\n      {\"@id\":\"terminus:update_schema\", \"@type\":\"terminus:DBAction\"},\n      {\"@id\":\"terminus:woql_select\", \"@type\":\"terminus:DBAction\"},\n      {\"@id\":\"terminus:woql_update\", \"@type\":\"terminus:DBAction\"}\n    ] */\nfunction authorityActionsToArr(action) {\n\tif (Array.isArray(action) === false) return [];\n\n\treturn action.map(item => item['@id']);\n}\n\nmodule.exports = {\n\tauthorityActionsToArr,\n};\n","\nconst CONST = require('./const');\nconst DispatchRequest = require('./dispatchRequest');\nconst ErrorMessage = require('./errorMessage');\nconst ConnectionCapabilities = require('./connectionCapabilities');\nconst ConnectionConfig = require('./connectionConfig');\n/**\n * @file Javascript WOQL client object\n * @license Apache Version 2\n * @summary Simple Javascript Client for accessing the Terminus DB API\n */\n\n/**\n  * @param {Object} params\n  */\nfunction WOQLClient(params) {\n\t// current connection context variables\n\tconst key = params ? params.key : undefined;\n\tthis.connectionConfig = new ConnectionConfig(params);\n\tthis.connection = new ConnectionCapabilities(this.connectionConfig, key);\n}\n\n/**\n * Connect to a Terminus server at the given URI with an API key\n * Stores the terminus:ServerCapability document returned\n * in the connection register which stores, the url, key, capabilities,\n * and database meta-data for the connected server\n *\n * If the curl argument is false or null,\n * this.connectionConfig.server will be used if present,\n * or the promise will be rejected.\n\n * @param  {string} curl Terminus server URI\n * @param  {string} API  key\n * @return {Promise}\n * @public\n */\nWOQLClient.prototype.connect = function (curl, key) {\n\tif (curl && !this.connectionConfig.setServer(curl)) {\n\t\treturn Promise.reject(\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(curl, CONST.CONNECT))\n\t\t);\n\t}\n\tconst serverURL = this.connectionConfig.serverURL();\n\n\tif (key) {\n\t\tthis.connection.setClientKey(serverURL, key);\n\t}\n\tconst self = this;\n\treturn this.dispatch(serverURL, CONST.CONNECT).then((response) => {\n\t\tself.connection.addConnection(serverURL, response);\n\t\treturn response;\n\t});\n};\n\n/**\n * Create a Terminus Database by posting\n * a terminus:Database document to the Terminus API\n *\n * The dburl argument can be\n *    1) a valid URL of a terminus database or\n *    2) a valid Terminus database id or\n *    3) can be omitted\n * \t\tin case 2) the current server will be used,\n * \t\tin case 3) the database id will be set from the @id field of the terminuse:Database document.\n *\n * The second (details) argument contains a terminus:Database document\n * with a mandatory rdfs:label field and an optional rdfs:comment field.\n * The third (key) argument contains an optional API key\n *\n * @param {string} dburl Terminus server URI or a TerminusID\n * @param {object} details\n * @param {string} key\n * @return {Promise}\n * @public\n */\nWOQLClient.prototype.createDatabase = function (dburl, details, key) {\n\tconsole.log('SONO IN CREATE_DATABASE');\n\tif (dburl && !this.connectionConfig.setDB(dburl)) {\n\t\treturn Promise.reject(\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(dburl, 'Create Database'))\n\t\t);\n\t} if (\n\t\tdetails\n    && details['@id']\n    && !this.connectionConfig.setDB(details['@id'], details['@context'])\n\t) {\n\t\treturn Promise.reject(\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(details['@id'], 'Create Database'))\n\t\t);\n\t}\n\n\tdetails = this.makeDocumentConsistentWithURL(details, this.connectionConfig.dbURL());\n\n\tconst opts = {};\n\tif (key) {\n\t\topts.key = key;\n\t}\n\tconst doc = this.addOptionsToDocument(details, opts);\n\treturn this.dispatch(this.connectionConfig.dbURL('create'), CONST.CREATE_DATABASE, doc);\n};\n\n/**\n * Delete a Database\n * @param {string} dburl it is a terminusDB Url or a terminusDB Id\n * @param {object} opts no options are currently supported for this function\n * @return {Promise}\n *\n * if dburl is omitted, the current server and database will be used\n */\nWOQLClient.prototype.deleteDatabase = function (dburl, opts) {\n\tif (dburl && !this.connectionConfig.setDB(dburl)) {\n\t\treturn Promise.reject(\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(dburl, 'Delete Database'))\n\t\t);\n\t}\n\tconst self = this;\n\treturn this.dispatch(`${this.connectionConfig.dbURL()}/`, CONST.DELETE_DATABASE, opts).then(\n\t\t(response) => {\n\t\t\tself.connection.removeDB();\n\t\t\treturn response;\n\t\t}\n\t);\n};\n\n/**\n * Retrieves the schema of the specified database\n *\n * @param {string} schurl TerminusDB server URL or a valid TerminusDB Id or omitted\n * @param {object} opts is an options object\n * @return {Promise}\n *\n * opts.format is optional and defines which format is requested (*json / turtle)\n * opts.key is an optional API key\n */\nWOQLClient.prototype.getSchema = function (schurl, opts) {\n\tif (schurl && this.connectionConfig.setSchemaURL(schurl)) {\n\t\treturn Promise.reject(\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(schurl, 'Get Schema'))\n\t\t);\n\t}\n\treturn this.dispatch(this.connectionConfig.schemaURL(), CONST.GET_SCHEMA, opts);\n};\n\n/**\n * Updates the Schema of the specified database\n *\n * @param {string} schurl TerminusDB server URL or a valid TerminusDB Id or omitted\n * @param {object} doc is a valid owl ontology in json-ld or turtle format\n * @param {object} opts is an options object\n * @return {Promise}\n *\n * if omitted the current server and database will be used\n * opts.format is used to specify which format is being used (*json / turtle)\n * opts.key is an optional API key\n */\nWOQLClient.prototype.updateSchema = function (schurl, doc, opts) {\n\tif (schurl && this.connectionConfig.setSchemaURL(schurl)) {\n\t\treturn Promise.reject(\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(schurl, 'Update Schema'))\n\t\t);\n\t}\n\tdoc = this.addOptionsToDocument(doc, opts);\n\treturn this.dispatch(this.connectionConfig.schemaURL(), 'update_schema', doc);\n};\n\n/**\n * Creates a new document in the specified database\n *\n * The first (docurl) argument can be\n * 1) a valid URL of a terminus database (an id will be randomly assigned) or\n * 2) a valid URL or of a terminus document (the document will be given the passed URL) or\n * 3) a valid terminus document id (the current server and database will be used)\n * 4) can be omitted (the URL will be taken from the document if present)\n * The second argument (doc) is a valid document in json-ld\n * the third argument (opts) is an options json - opts.key is an optional API key\n */\nWOQLClient.prototype.createDocument = function (docurl, doc, opts) {\n\tif (docurl && !this.connectionConfig.setDocument(docurl)) {\n\t\treturn Promise.reject(\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(docurl, 'Create Document'))\n\t\t);\n\t} if (\n\t\tdoc\n    && doc['@id']\n    && !this.connectionConfig.setDocument(doc['@id'], doc['@context'])\n\t) {\n\t\treturn Promise.reject(\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(doc['@id'], 'Create Document'))\n\t\t);\n\t}\n\tdoc = this.addOptionsToDocument(\n\t\tthis.makeDocumentConsistentWithURL(docurl, doc),\n\t\topts\n\t);\n\treturn this.dispatch(this.docURL(), 'create_document', doc);\n};\n\n/**\n * Retrieves a document from the specified database\n *\n * The first (docurl) argument can be\n * 1) a valid URL of a terminus document or\n * 2) a valid ID of a terminus document in the current database\n * the second argument (opts) is an options json -\n * \t\topts.key is an optional API key\n * \t\topts.shape is frame | *document\n */\nWOQLClient.prototype.getDocument = function (docurl, opts) {\n\tif (docurl && (!this.connectionConfig.setDocument(docurl) || !this.connectionConfig.docid)) {\n\t\treturn Promise.reject(\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(docurl, 'Get Document'))\n\t\t);\n\t}\n\treturn this.dispatch(this.docURL(), 'get_document', opts);\n};\n\n/**\n * Updates a document in the specified database with a new version\n *\n * The first (docurl) argument can be\n * 1) a valid URL of a terminus document or\n * 2) a valid ID of a terminus document in the current database or\n * 3) omitted in which case the id will be taken from the document @id field\n * the second argument (doc) is a document in json-ld format\n * the third argument (opts) is an options json - opts.key is an optional API key\n */\nWOQLClient.prototype.updateDocument = function (docurl, doc, opts) {\n\tif (docurl && !this.connectionConfig.setDocument(docurl)) {\n\t\treturn Promise.reject(\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(docurl, 'Update Document'))\n\t\t);\n\t} if (doc\n    && doc['@id']\n    && !this.connectionConfig.setDocument(doc['@id'], doc['@context'])\n\t) {\n\t\treturn Promise.reject(\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(doc['@id'], 'Update Document'))\n\t\t);\n\t}\n\tdoc = this.addOptionsToDocument(\n\t\tthis.makeDocumentConsistentWithURL(docurl, doc),\n\t\topts\n\t);\n\treturn this.dispatch(this.docURL(), 'update_document', doc);\n};\n\n/**\n * Deletes a document from the specified database\n *\n * The first (docurl) argument can be\n * 1) a valid URL of a terminus document or\n * 2) a valid ID of a terminus document in the current database\n * 3) omitted - the current document will be used\n * the second argument (opts) is an options json - opts.key is an optional API key\n */\nWOQLClient.prototype.deleteDocument = function (docurl, opts) {\n\tif (docurl && (!this.connectionConfig.setDocument(docurl) || !this.connectionConfig.docid)) {\n\t\treturn Promise.reject(\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(docurl, 'Delete Document'))\n\t\t);\n\t}\n\treturn this.dispatch(this.docURL(), 'delete_document', opts);\n};\n\n/**\n * Executes a read-only WOQL query on the specified database and returns the results\n *\n * The first (qurl) argument can be\n * 1) a valid URL of a terminus database or\n * 2) omitted - the current database will be used\n * the second argument (woql) is a woql select statement encoded as a string\n * the third argument (opts) is an options json - opts.key is an API key\n */\nWOQLClient.prototype.select = function (qurl, woql, opts) {\n\tif (qurl && this.setQueryURL(qurl)) {\n\t\treturn Promise.reject(\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(qurl, 'Select'))\n\t\t);\n\t}\n\tlet q = { query: woql };\n\tq = this.addOptionsToWOQL(q, opts);\n\treturn this.dispatch(this.queryURL(), 'woql_select', q);\n};\n\n/**\n * Executes a WOQL query on the specified database which updates the state and returns the results\n *\n * The first (qurl) argument can be\n * 1) a valid URL of a terminus database or\n * 2) omitted - the current database will be used\n * the second argument (woql) is a woql select statement encoded as a string\n * the third argument (opts) is an options json - opts.key is an optional API key\n */\nWOQLClient.prototype.update = function (qurl, woql, opts) {\n\tif (qurl && this.setQueryURL(qurl)) {\n\t\treturn Promise.reject(\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(qurl, 'Update'))\n\t\t);\n\t}\n\twoql = this.addOptionsToWOQL(woql, opts);\n\treturn this.dispatch(this.queryURL(), 'woql_update', woql);\n};\n\n/**\n * Retrieves a WOQL query on the specified database which updates the state and returns the results\n *\n * The first (cfurl) argument can be\n * 1) a valid URL of a terminus database or\n * 2) omitted - the current database will be used\n * the second argument (cls) is the URL / ID of a document class that exists in the database schema\n * the third argument (opts) is an options json - opts.key is an optional API key\n */\nWOQLClient.prototype.getClassFrame = function (cfurl, cls, opts) {\n\tif (cfurl && this.setClassFrameURL(cfurl)) {\n\t\treturn Promise.reject(\n\t\t\tnew URIError(ErrorMessage.getInvalidURIMessage(cfurl, 'Get Class Frame'))\n\t\t);\n\t}\n\tif (!opts) opts = {};\n\topts.class = cls;\n\treturn this.dispatch(this.frameURL(), 'class_frame', opts);\n};\n\n/*\n * Utility functions for adding standard fields to API arguments\n */\nWOQLClient.prototype.addOptionsToWOQL = function (woql, opts) {\n\tif (opts && opts.key) {\n\t\twoql.key = opts.key;\n\t}\n\treturn woql;\n};\n\nWOQLClient.prototype.addOptionsToDocument = function (doc, opts) {\n\tconst pdoc = { 'terminus:document': doc };\n\tpdoc['@context'] = doc['@context'];\n\tdelete pdoc['terminus:document']['@context'];\n\tpdoc['@type'] = 'terminus:APIUpdate';\n\tif (opts && opts.key) {\n\t\tpdoc.key = opts.key;\n\t}\n\treturn pdoc;\n};\n\nWOQLClient.prototype.addKeyToPayload = function (payload) {\n\tif (payload && payload.key) {\n\t\tpayload['terminus:user_key'] = payload.key;\n\t\tdelete payload.key;\n\t} else if (this.connection[this.server] && this.connection[this.server].key) {\n\t\tif (!payload) payload = {};\n\t\tpayload['terminus:user_key'] = this.connection[this.server].key;\n\t}\n\treturn payload;\n};\n\nWOQLClient.prototype.makeDocumentConsistentWithURL = function (doc, dburl) {\n\tdoc['@id'] = dburl;\n\treturn doc;\n};\n\nWOQLClient.prototype.dispatch = function (url, action, payload) {\n\tconsole.log('SONO IN DISPATCH');\n\tif (action !== CONST.CONNECT\n         && this.connectionConfig.connectionMode()\n         && !this.connection.serverConnected(this.server)) {\n\t\tconsole.log('CONNECT CALL AGAIN');\n\t\tconst key = payload && payload.key ? payload.key : false;\n\t\tconst self = this;\n\n\t\treturn this.connect(this.server, key).then((response) => {\n\t\t\tif (key) delete payload.key;\n\t\t\tself.dispatch(url, action, payload);\n\t\t\treturn response;\n\t\t});\n\t}\n\tif (!this.connection.capabilitiesPermit(action)) {\n\t\treturn Promise.reject(\n\t\t\tnew Error(ErrorMessage.getAccessDeniedMessage(url, action, this.error))\n\t\t);\n\t}\n\tif (this.connectionConfig.includeKey()) {\n\t\tpayload = this.addKeyToPayload(payload);\n\t}\n\n\treturn new DispatchRequest(url, action, payload);\n};\n\nmodule.exports = WOQLClient;\n"]}